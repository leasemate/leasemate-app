import{K as w,r as u,q as b,s as y,o as I,c as S,w as T,a as t,t as h,k as C,x as E,A as _}from"./app-87377a4a.js";import{_ as B}from"./AuthenticatedLayout-d79ee3ae.js";import{l as N}from"./index-fb0b8ccc.js";import"./_plugin-vue_export-helper-c27b6911.js";const O=t("h1",null,"Flowise test",-1),q={class:"p-4"},A={class:"mt-2"},f=5,M={__name:"NodeWebsocket",setup(D){const m=w(),d=u(m.props.auth.user),k=u("Connecting..."),a=u(""),l=u(""),s=N("https://reai-node-lgfv.onrender.com");let p="",v="46af2d48-8ed8-48ee-9f21-2c88c40bb876",o="";async function g(){a.value="";const n={question:l.value,socketIOClientId:p,chatSessionId:v};console.log(n);try{const e="http://localhost:3000/api/v1/chat",x={headers:{Authorization:"Bearer "+d.value.jwt_token}};await _.post(e,n,x).then(function(r){console.log("axios post response:",r.data)}).catch(async function(r){console.log(r),r.response.data.error_type=="TokenExpiredError"&&await _.post(route("refreshToken")).then(function(i){console.log("axios post response:",i.data),d.value.jwt_token=i.data.token,g()}).catch(function(i){console.log(i),console.log("TokenExpiredError")}).then(function(){})})}catch{}}return b(async()=>{console.log(d.value),s.on("connect",()=>{p=s.id,console.log("Connected with id:",p)}),s.on("start",()=>{console.log("START!!!")}),s.on("token",n=>{if(o+=n,o.length>=f){let e=o.lastIndexOf(" ",f);e===-1&&(e=f);const c=o.slice(0,e+1);a.value+=c,o=o.slice(e+1)}}),s.on("end",()=>{console.log("END!!!"),console.log(o),o.trim().length>0&&(a.value+=o),o=""})}),y(()=>{s.disconnect()}),(n,e)=>(I(),S(B,null,{default:T(()=>[O,t("p",null,"WebSocket Status: "+h(k.value),1),t("div",q,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>l.value=c),class:"w-full px-3 py-2 border rounded-lg shadow-md focus:outline-none focus:ring focus:border-blue-300",placeholder:"Type something..."},null,512),[[E,l.value]]),t("p",A,"You typed: "+h(l.value),1)]),t("button",{onClick:g,class:"btn"},"Get message"),t("p",null,h(a.value),1)]),_:1}))}};export{M as default};
