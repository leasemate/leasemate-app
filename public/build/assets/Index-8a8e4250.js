import{_ as U,t as B,h as P,f as A}from"./AuthenticatedLayout-2c5eba01.js";import{o,c as y,w as l,r as S,u as f,i as $,K as O,h as j,m as v,C as L,D as R,k as T,O as F,E as Y,f as d,a as i,F as D,Z as z,d as g,b as e,t as m,g as p,s as I,n as K}from"./app-b7d91a43.js";import{V as q,p as J,s as X}from"./filepond-plugin-file-validate-type.esm-e9ceef25.js";import{_ as Z}from"./Pagination-046a3c3a.js";import{_ as G,a as H,D as C}from"./DangerButton-2593cf55.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./feather-226f285e.js";const Q={__name:"SuccessLink",props:{type:{type:String,default:"button"}},setup(a){return(c,u)=>(o(),y(f($),{type:a.type,class:"btn text-white bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600 focus:bg-green-600 focus:border-green-600 focus:ring focus:ring-green-500/30 active:bg-green-600 active:border-green-600"},{default:l(()=>[S(c.$slots,"default")]),_:3},8,["type"]))}},W={__name:"PrimaryLink",setup(a){return(c,u)=>(o(),y(f($),{class:"btn text-white bg-violet-500 border-violet-500 hover:bg-violet-600 hover:border-violet-600 focus:bg-violet-600 focus:border-violet-600 focus:ring focus:ring-violet-500/30 active:bg-violet-600 active:border-violet-600"},{default:l(()=>[S(c.$slots,"default")]),_:3}))}},ee={class:"py-6"},te={key:0,class:"relative flex justify-end mb-4"},se={class:"py-6"},oe={key:1,class:"flex flex-col"},ae={class:"overflow-x-auto"},le={class:"inline-block min-w-full align-middle"},re={class:"overflow-visible"},ie={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},ne=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"})])],-1),de={class:"divide-y divide-gray-200 dark:divide-gray-600"},ce={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ue=["href"],me={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},pe={class:"text-xs"},fe={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},_e={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},he={key:0,class:"ml-2 spinner-border animate-spin inline-block w-3 h-3 border-[2px] border-l-transparent border-red-400 rounded-full"},ge=e("span",{class:"hidden"},"Loading...",-1),ve=[ge],ye={class:"p-3.5"},be=e("i",{class:"bx bx-trash text-lg"},null,-1),xe={key:1},ke={class:"p-6"},we=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),Fe={class:"mt-6 flex justify-end"},Ue={__name:"Index",props:{uploaded_files:{type:Object},archived:{type:Number},trashed_file_count:{type:Number}},setup(a){const c=O(),u=j(()=>c.props.auth.user),{getFileStatusClass:E}=A(),n=v(null),b=v(!1),M=s=>{b.value=!0,n.value=s},x=()=>{b.value=!1},k=v(null),_=L({}),N=async()=>{if(n.value){k.value=n.value.id,_[n.value.id]="Deleting",x();try{await new Promise((s,r)=>{F.delete(route("files.destroy",n.value.id),{preserveScroll:!0,onSuccess:()=>{_[n.value.id]="",n.value=null,k.value=null,s()},onError:()=>{r(new Error("Failed to delete file"))}})})}catch(s){B.error(s),console.log(s)}}},V=q(J),w=v([]);let h="";return X({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":c.props.csrf},onerror:s=>{console.log("on error"),h=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),h.errors&&h.errors.upload_file?h.errors.upload_file.join(" "):h.message)}),R(u,(s,r)=>{r&&Echo.leave(`App.Models.User.${r.id}`)},{immediate:!1}),T(()=>{Echo.private(`App.Models.User.${u.value.id}`).listen("FileStatusUpdate",s=>{F.reload({only:["uploaded_files"]})})}),Y(()=>{u.value&&Echo.leave(`App.Models.User.${u.value.id}`)}),(s,r)=>(o(),d(D,null,[i(f(z),{title:"File Upload"}),i(U,null,{header:l(()=>[g(" Files ")]),default:l(()=>[e("div",ee,[a.trashed_file_count?(o(),d("div",te,[i(W,{href:s.route("files.index",{archived:!a.archived})},{default:l(()=>[g(m(a.archived?"Current":"Archived")+" Files ",1)]),_:1},8,["href"])])):p("",!0),e("div",se,[a.archived?p("",!0):(o(),y(f(V),{key:0,name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=t=>w.value=t)},null,8,["modelValue"]))]),a.uploaded_files.data.length?(o(),d("div",oe,[e("div",ae,[e("div",le,[e("div",re,[e("table",ie,[ne,e("tbody",de,[(o(!0),d(D,null,I(a.uploaded_files.data,t=>(o(),d("tr",{key:t.id},[e("td",ce,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},m(t.original_name),9,ue)]),e("td",me,[e("p",null,m(f(P)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",pe,"by "+m(t.user.name),1)]),e("td",fe,m(t.size_readable),1),e("td",_e,[e("span",{class:K(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",f(E)(_[t.id]==="Deleting"?"Deleting":t.status)])},m(_[t.id]==="Deleting"?"Deleting":t.status),3),_[t.id]==="Deleting"?(o(),d("div",he,ve)):p("",!0)]),e("td",ye,[["Pending","Completed","Failed"].includes(t.status)?(o(),y(C,{key:0,onClick:De=>M(t)},{default:l(()=>[be]),_:2},1032,["onClick"])):p("",!0),t.status=="Deleted"?(o(),d("div",xe,[i(Q,{href:s.route("files.restore",t),method:"post",as:"button"},{default:l(()=>[g(" Restore ")]),_:2},1032,["href"])])):p("",!0)])]))),128))])])])])])])):p("",!0),i(Z,{dataset:a.uploaded_files,class:"mt-4"},null,8,["dataset"]),i(G,{show:b.value,onClose:x},{default:l(()=>[e("div",ke,[we,e("div",Fe,[i(H,{onClick:x},{default:l(()=>[g(" Cancel ")]),_:1}),i(C,{class:"ml-3",onClick:r[1]||(r[1]=t=>N())},{default:l(()=>[g(" Delete ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Ue as default};
