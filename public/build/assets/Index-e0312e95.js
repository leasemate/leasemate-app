import{_ as U,t as A,h as B,f as O}from"./AuthenticatedLayout-79a8aba5.js";import{o as a,c as y,w as l,r as E,u as c,i as M,K as j,h as R,m as h,C as L,D as T,k as Y,O as F,E as z,f as d,a as i,F as S,Z as I,d as v,b as e,t as p,g as f,s as K,n as C}from"./app-14929e11.js";import{V as q,p as J,s as X}from"./filepond-plugin-file-validate-type.esm-3994c5d9.js";import{_ as Z}from"./Pagination-52a33036.js";import{_ as G,a as H,D as $}from"./DangerButton-cc99e973.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./feather-566c1fc0.js";const Q={__name:"SuccessLink",props:{type:{type:String,default:"button"}},setup(o){return(u,m)=>(a(),y(c(M),{type:o.type,class:"btn text-white bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600 focus:bg-green-600 focus:border-green-600 focus:ring focus:ring-green-500/30 active:bg-green-600 active:border-green-600"},{default:l(()=>[E(u.$slots,"default")]),_:3},8,["type"]))}},W={__name:"PrimaryLink",setup(o){return(u,m)=>(a(),y(c(M),{class:"btn text-white bg-violet-500 border-violet-500 hover:bg-violet-600 hover:border-violet-600 focus:bg-violet-600 focus:border-violet-600 focus:ring focus:ring-violet-500/30 active:bg-violet-600 active:border-violet-600"},{default:l(()=>[E(u.$slots,"default")]),_:3}))}},ee={class:"py-6"},te={key:0,class:"relative flex justify-end mb-4"},se={class:"py-6"},ae={key:1,class:"flex flex-col"},oe={class:"overflow-x-auto"},le={class:"inline-block min-w-full align-middle"},re={class:"overflow-visible"},ie={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},ne=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"})])],-1),de={class:"divide-y divide-gray-200 dark:divide-gray-600"},ce={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ue=["href"],me={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},pe={class:"text-xs"},fe={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},_e={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ge={key:0,class:"animate-pulse inline-block ml-2"},ve={class:"p-3.5"},he=e("i",{class:"bx bx-trash text-lg"},null,-1),ye={key:1},xe={class:"p-6"},be=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),ke={class:"mt-6 flex justify-end"},Ne={__name:"Index",props:{uploaded_files:{type:Object},archived:{type:Number},trashed_file_count:{type:Number}},setup(o){const u=j(),m=R(()=>u.props.auth.user),{getFileStatusClass:k}=O(),n=h(null),x=h(!1),N=s=>{x.value=!0,n.value=s},b=()=>{x.value=!1},w=h(null),_=L({}),V=async()=>{if(n.value){w.value=n.value.id,_[n.value.id]="Deleting",b();try{await new Promise((s,r)=>{F.delete(route("files.destroy",n.value.id),{preserveScroll:!0,onSuccess:()=>{_[n.value.id]="",n.value=null,w.value=null,s()},onError:()=>{r(new Error("Failed to delete file"))}})})}catch(s){A.error(s),console.log(s)}}},P=q(J),D=h([]);let g="";return X({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":u.props.csrf},onerror:s=>{console.log("on error"),g=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),g.errors&&g.errors.upload_file?g.errors.upload_file.join(" "):g.message)}),T(m,(s,r)=>{r&&Echo.leave(`App.Models.User.${r.id}`)},{immediate:!1}),Y(()=>{Echo.private(`App.Models.User.${m.value.id}`).listen("FileStatusUpdate",s=>{F.reload({only:["uploaded_files"]})})}),z(()=>{m.value&&Echo.leave(`App.Models.User.${m.value.id}`)}),(s,r)=>(a(),d(S,null,[i(c(I),{title:"File Upload"}),i(U,null,{header:l(()=>[v(" Files ")]),default:l(()=>[e("div",ee,[o.trashed_file_count?(a(),d("div",te,[i(W,{href:s.route("files.index",{archived:!o.archived})},{default:l(()=>[v(p(o.archived?"Current":"Archived")+" Files ",1)]),_:1},8,["href"])])):f("",!0),e("div",se,[o.archived?f("",!0):(a(),y(c(P),{key:0,name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:D.value,"onUpdate:modelValue":r[0]||(r[0]=t=>D.value=t)},null,8,["modelValue"]))]),o.uploaded_files.data.length?(a(),d("div",ae,[e("div",oe,[e("div",le,[e("div",re,[e("table",ie,[ne,e("tbody",de,[(a(!0),d(S,null,K(o.uploaded_files.data,t=>(a(),d("tr",{key:t.id},[e("td",ce,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},p(t.original_name),9,ue)]),e("td",me,[e("p",null,p(c(B)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",pe,"by "+p(t.user.name),1)]),e("td",fe,p(t.size_readable),1),e("td",_e,[e("span",{class:C(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",c(k)(_[t.id]==="Deleting"?"Deleting":t.status)])},[e("span",null,p(_[t.id]==="Deleting"?"Deleting":t.status),1)],2),t.status!="completed"?(a(),d("div",ge,[e("div",{class:C(["rounded-full h-3 w-3",c(k)(_[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2)])):f("",!0)]),e("td",ve,[["Pending","Completed","Failed"].includes(t.status)?(a(),y($,{key:0,onClick:we=>N(t)},{default:l(()=>[he]),_:2},1032,["onClick"])):f("",!0),t.status=="Deleted"?(a(),d("div",ye,[i(Q,{href:s.route("files.restore",t),method:"post",as:"button"},{default:l(()=>[v(" Restore ")]),_:2},1032,["href"])])):f("",!0)])]))),128))])])])])])])):f("",!0),i(Z,{dataset:o.uploaded_files,class:"mt-4"},null,8,["dataset"]),i(G,{show:x.value,onClose:b},{default:l(()=>[e("div",xe,[be,e("div",ke,[i(H,{onClick:b},{default:l(()=>[v(" Cancel ")]),_:1}),i($,{class:"ml-3",onClick:r[1]||(r[1]=t=>V())},{default:l(()=>[v(" Delete ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Ne as default};
