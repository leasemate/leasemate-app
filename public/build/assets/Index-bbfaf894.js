import{_ as V,t as M,h as $,f as B}from"./AuthenticatedLayout-136ac56d.js";import{K as E,h as P,m as _,C as U,k as j,O as w,D as O,o,f as a,a as r,u as m,w as d,F as D,Z as A,d as f,b as e,j as R,t as c,g as p,c as T,s as Y,n as z}from"./app-6dd20709.js";import{V as I,p as K,s as q}from"./filepond-plugin-file-validate-type.esm-95ca9a0e.js";import{_ as J}from"./Pagination-d983caf0.js";import{_ as L,a as X,D as Z}from"./DangerButton-6b88a930.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./feather-7c9e45c7.js";const G={class:"py-6"},H={key:0,class:"relative flex justify-end mb-4"},Q={class:"py-6"},W={key:1,class:"flex flex-col"},ee={class:"overflow-x-auto"},te={class:"inline-block min-w-full align-middle"},se={class:"overflow-visible"},oe={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},le=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"}," Action ")])],-1),ae={class:"divide-y divide-gray-200 dark:divide-gray-600"},re={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ie=["href"],ne={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},de={class:"text-xs"},ce={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ue={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},me={class:"p-3.5"},pe=["onClick"],_e=e("i",{class:"bx bx-trash text-lg hover:text-red-400"},null,-1),fe=[_e],he={key:1},ve={class:"p-6"},ge=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),xe={class:"mt-6 flex justify-end"},Ne={__name:"Index",props:{uploaded_files:{type:Object},show_deleted:{type:Number},trashed_file_count:{type:Number}},setup(l){const x=E(),y=P(()=>x.props.auth.user),{getFileStatusClass:F}=B(),i=_(null),h=_(!1),C=s=>{h.value=!0,i.value=s},v=()=>{h.value=!1},b=_(null),g=U({}),S=async()=>{if(i.value){b.value=i.value.id,g[i.value.id]="Deleting",v();try{await new Promise((s,n)=>{w.delete(route("files.destroy",i.value.id),{preserveScroll:!0,onSuccess:()=>{i.value=null,b.value=null,s()},onError:()=>{n(new Error("Failed to delete file"))}})})}catch(s){M.error(s),console.log(s)}}},N=I(K),k=_([]);let u="";return q({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":x.props.csrf},onerror:s=>{console.log("on error"),u=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),u.errors&&u.errors.upload_file?u.errors.upload_file.join(" "):u.message)}),j(()=>{Echo.private(`App.Models.User.${y.value.id}`).listen("FileStatusUpdate",s=>{w.reload({only:["uploaded_files"]})})}),O(()=>{Echo.leave(`App.Models.User.${y.value.id}`)}),(s,n)=>(o(),a(D,null,[r(m(A),{title:"File Upload"}),r(V,null,{header:d(()=>[f(" Files ")]),default:d(()=>[e("div",G,[l.trashed_file_count?(o(),a("div",H,[r(m(R),{href:s.route("files.index",{show_deleted:!l.show_deleted}),type:"button",class:"mb-4 btn text-white bg-violet-500 border-violet-500 hover:bg-violet-600 hover:border-violet-600 focus:bg-violet-600 focus:border-violet-600 focus:ring focus:ring-violet-500/30 active:bg-violet-600 active:border-violet-600"},{default:d(()=>[f(c(l.show_deleted?"Current":"Deleted")+" Files ",1)]),_:1},8,["href"])])):p("",!0),e("div",Q,[l.show_deleted?p("",!0):(o(),T(m(N),{key:0,name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=t=>k.value=t)},null,8,["modelValue"]))]),l.uploaded_files.data.length?(o(),a("div",W,[e("div",ee,[e("div",te,[e("div",se,[e("table",oe,[le,e("tbody",ae,[(o(!0),a(D,null,Y(l.uploaded_files.data,t=>(o(),a("tr",{key:t.id},[e("td",re,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},c(t.original_name),9,ie)]),e("td",ne,[e("p",null,c(m($)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",de,"by "+c(t.user.name),1)]),e("td",ce,c(t.size_readable),1),e("td",ue,[e("span",{class:z(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",m(F)(g[t.id]==="Deleting"?"Deleting":t.status)])},c(g[t.id]==="Deleting"?"Deleting":t.status),3)]),e("td",me,[t.status=="Pending"||t.status=="Completed"?(o(),a("button",{key:0,onClick:ye=>C(t)},fe,8,pe)):p("",!0),t.status=="Deleted"?(o(),a("div",he," Restore | Permanently Delete ")):p("",!0)])]))),128))])])])])])])):p("",!0),r(J,{dataset:l.uploaded_files,class:"mt-4"},null,8,["dataset"]),r(L,{show:h.value,onClose:v},{default:d(()=>[e("div",ve,[ge,e("div",xe,[r(X,{onClick:v},{default:d(()=>[f(" Cancel ")]),_:1}),r(Z,{class:"ml-3",onClick:n[1]||(n[1]=t=>S())},{default:d(()=>[f(" Delete File ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Ne as default};
