import{Q as w,r as u,j as b,m as y,o as I,c as S,w as T,a as e,t as h,p as C,v as E,x as g}from"./app-68f2f160.js";import{_ as B}from"./AuthenticatedLayout-cacf9b2a.js";import{l as N}from"./index-e3f35709.js";import"./toast-16faa1c6.js";import"./DropdownLink-f62a0199.js";import"./index-ee8fd73a.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ToastList-10cb7144.js";const O=e("h1",null,"Flowise test",-1),j={class:"p-4"},D={class:"mt-2"},f=5,H={__name:"NodeWebsocket",setup(U){const _=w(),p=u(_.props.auth.user),v=u("Connecting..."),a=u(""),l=u(""),n=N("https://reai-node-lgfv.onrender.com");let d="",k="46af2d48-8ed8-48ee-9f21-2c88c40bb876",o="";async function m(){a.value="";const s={question:l.value,socketIOClientId:d,chatSessionId:k};console.log(s);try{const t="http://localhost:3000/api/v1/chat",x={headers:{Authorization:"Bearer "+p.value.jwt_token}};await g.post(t,s,x).then(function(r){console.log("axios post response:",r.data)}).catch(async function(r){console.log(r),r.response.data.error_type=="TokenExpiredError"&&await g.post(route("refreshToken")).then(function(i){console.log("axios post response:",i.data),p.value.jwt_token=i.data.token,m()}).catch(function(i){console.log(i),console.log("TokenExpiredError")}).then(function(){})})}catch{}}return b(async()=>{console.log(p.value),n.on("connect",()=>{d=n.id,console.log("Connected with id:",d)}),n.on("start",()=>{console.log("START!!!")}),n.on("token",s=>{if(o+=s,o.length>=f){let t=o.lastIndexOf(" ",f);t===-1&&(t=f);const c=o.slice(0,t+1);a.value+=c,o=o.slice(t+1)}}),n.on("end",()=>{console.log("END!!!"),console.log(o),o.trim().length>0&&(a.value+=o),o=""})}),y(()=>{n.disconnect()}),(s,t)=>(I(),S(B,null,{default:T(()=>[O,e("p",null,"WebSocket Status: "+h(v.value),1),e("div",j,[C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>l.value=c),class:"w-full px-3 py-2 border rounded-lg shadow-md focus:outline-none focus:ring focus:border-blue-300",placeholder:"Type something..."},null,512),[[E,l.value]]),e("p",D,"You typed: "+h(l.value),1)]),e("button",{onClick:m,class:"btn"},"Get message"),e("p",null,h(a.value),1)]),_:1}))}};export{H as default};
