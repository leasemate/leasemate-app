import{_ as O,t as V,h as U,f as R}from"./AuthenticatedLayout-d0fbc085.js";import{o as l,c as b,w as o,m as $,u as n,i as P,K as j,j as B,r as y,C as L,D as T,p as Y,O as F,E as z,d as i,b as d,F as w,Z as I,f as g,a as e,t as f,e as v,g as K,n as x}from"./app-44bf7975.js";import{V as q,p as J,s as X}from"./filepond-plugin-file-validate-type.esm-600e8f83.js";import{_ as Z}from"./Pagination-1f4fd22c.js";import{_ as G}from"./Modal-2ee2e1e2.js";import{_ as H}from"./SecondaryButton-767ef76b.js";import{_ as E}from"./DangerButton-95a76422.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./feather-3e670bb2.js";const Q={__name:"SuccessLink",props:{type:{type:String,default:"button"}},setup(a){return(m,p)=>(l(),b(n(P),{type:a.type,class:"btn text-white bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600 focus:bg-green-600 focus:border-green-600 focus:ring focus:ring-green-500/30 active:bg-green-600 active:border-green-600"},{default:o(()=>[$(m.$slots,"default")]),_:3},8,["type"]))}},W={__name:"PrimaryLink",setup(a){return(m,p)=>(l(),b(n(P),{class:"btn text-white bg-violet-500 border-violet-500 hover:bg-violet-600 hover:border-violet-600 focus:bg-violet-600 focus:border-violet-600 focus:ring focus:ring-violet-500/30 active:bg-violet-600 active:border-violet-600"},{default:o(()=>[$(m.$slots,"default")]),_:3}))}},ee={class:"py-6"},te={key:0,class:"relative flex justify-end mb-4"},se={class:"py-6"},le={key:1,class:"flex flex-col"},ae={class:"overflow-x-auto"},oe={class:"inline-block min-w-full align-middle"},re={class:"overflow-visible"},ne={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},ie=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"})])],-1),de={class:"divide-y divide-gray-200 dark:divide-gray-600"},ce={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ue=["href"],me={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},pe={class:"text-xs"},fe={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},_e={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ge={class:"relative mr-1.5 flex h-2.5 w-2.5"},ve={class:"p-3.5"},he=e("i",{class:"bx bx-trash text-lg"},null,-1),ye={key:1},xe={class:"p-6"},be=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),ke={class:"mt-6 flex justify-end"},Ne={__name:"Index",props:{uploaded_files:{type:Object},archived:{type:Number},trashed_file_count:{type:Number}},setup(a){const m=j(),p=B(()=>m.props.auth.user),{getFileStatusClass:h}=R(),c=y(null),k=y(!1),A=s=>{k.value=!0,c.value=s},S=()=>{k.value=!1},D=y(null),u=L({}),M=async()=>{if(c.value){D.value=c.value.id,u[c.value.id]="Deleting",S();try{await new Promise((s,r)=>{F.delete(route("files.destroy",c.value.id),{preserveScroll:!0,onSuccess:()=>{u[c.value.id]="",c.value=null,D.value=null,s()},onError:()=>{r(new Error("Failed to delete file"))}})})}catch(s){V.error(s),console.log(s)}}},N=q(J),C=y([]);let _="";return X({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":m.props.csrf},onerror:s=>{console.log("on error"),_=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),_.errors&&_.errors.upload_file?_.errors.upload_file.join(" "):_.message)}),T(p,(s,r)=>{r&&Echo.leave(`App.Models.User.${r.id}`)},{immediate:!1}),Y(()=>{Echo.private(`App.Models.User.${p.value.id}`).listen("FileStatusUpdate",s=>{F.reload({only:["uploaded_files"]})})}),z(()=>{p.value&&Echo.leave(`App.Models.User.${p.value.id}`)}),(s,r)=>(l(),i(w,null,[d(n(I),{title:"File Upload"}),d(O,null,{header:o(()=>[g(" Files ")]),default:o(()=>[e("div",ee,[a.trashed_file_count?(l(),i("div",te,[d(W,{href:s.route("files.index",{archived:!a.archived})},{default:o(()=>[g(f(a.archived?"Current":"Archived")+" Files ",1)]),_:1},8,["href"])])):v("",!0),e("div",se,[a.archived?v("",!0):(l(),b(n(N),{key:0,name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:C.value,"onUpdate:modelValue":r[0]||(r[0]=t=>C.value=t)},null,8,["modelValue"]))]),a.uploaded_files.data.length?(l(),i("div",le,[e("div",ae,[e("div",oe,[e("div",re,[e("table",ne,[ie,e("tbody",de,[(l(!0),i(w,null,K(a.uploaded_files.data,t=>(l(),i("tr",{key:t.id},[e("td",ce,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},f(t.original_name),9,ue)]),e("td",me,[e("p",null,f(n(U)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",pe,"by "+f(t.user.name),1)]),e("td",fe,f(t.size_readable),1),e("td",_e,[e("span",{class:x(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",n(h)(u[t.id]==="Deleting"?"Deleting":t.status)])},[e("span",ge,[t.status!="Completed"?(l(),i(w,{key:0},[e("span",{class:x(["absolute inline-flex h-full w-full animate-ping rounded-full",n(h)(u[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2),e("span",{class:x(["relative inline-flex h-2.5 w-2.5 rounded-full",n(h)(u[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2)],64)):(l(),i("span",{key:1,class:x(["relative inline-flex h-2.5 w-2.5 rounded-full",n(h)(u[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2))]),e("span",null,f(u[t.id]==="Deleting"?"Deleting":t.status),1)],2)]),e("td",ve,[["Pending","Completed","Failed"].includes(t.status)?(l(),b(E,{key:0,onClick:Se=>A(t)},{default:o(()=>[he]),_:2},1032,["onClick"])):v("",!0),t.status=="Deleted"?(l(),i("div",ye,[d(Q,{href:s.route("files.restore",t),method:"post",as:"button"},{default:o(()=>[g(" Restore ")]),_:2},1032,["href"])])):v("",!0)])]))),128))])])])])])])):v("",!0),d(Z,{dataset:a.uploaded_files,class:"mt-4"},null,8,["dataset"]),d(G,{show:k.value,onClose:S},{default:o(()=>[e("div",xe,[be,e("div",ke,[d(H,{onClick:S},{default:o(()=>[g(" Cancel ")]),_:1}),d(E,{class:"ml-3",onClick:r[1]||(r[1]=t=>M())},{default:o(()=>[g(" Delete ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Ne as default};
