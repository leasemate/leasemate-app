import{_ as V,t as M,h as $,f as E}from"./AuthenticatedLayout-70f8e880.js";import{K as P,h as U,m as p,C as j,k as B,O as k,D as O,o as l,f as a,a as o,u as m,w as d,F as D,Z as A,d as _,b as e,j as R,t as c,g as f,s as T,n as Y}from"./app-63c014fa.js";import{V as z,p as I,s as K}from"./filepond-plugin-file-validate-type.esm-68e53a72.js";import{_ as q}from"./Pagination-05be3132.js";import{_ as H,a as J,D as L}from"./DangerButton-64499dbb.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./feather-2091e587.js";const X={class:"py-6"},Z={key:0,class:"relative flex justify-end mb-4"},G={class:"py-6"},Q={key:1,class:"flex flex-col"},W={class:"overflow-x-auto"},ee={class:"inline-block min-w-full align-middle"},te={class:"overflow-visible"},se={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},oe=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"}," Action ")])],-1),le={class:"divide-y divide-gray-200 dark:divide-gray-600"},ae={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},re=["href"],ie={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ne={class:"text-xs"},de={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ce={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ue={class:"p-3.5"},me=["onClick"],pe=e("i",{class:"bx bx-trash text-lg hover:text-red-400"},null,-1),_e=[pe],fe={key:1},he={class:"p-6"},ve=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),ge={class:"mt-6 flex justify-end"},Se={__name:"Index",props:{uploaded_files:{type:Object},show_deleted:{type:Number},trashed_file_count:{type:Number}},setup(r){const x=P(),y=U(()=>x.props.auth.user),{getFileStatusClass:F}=E(),i=p(null),h=p(!1),C=s=>{h.value=!0,i.value=s},v=()=>{h.value=!1},b=p(null),g=j({}),S=async()=>{if(i.value){b.value=i.value.id,g[i.value.id]="Deleting",v();try{await new Promise((s,n)=>{k.delete(route("files.destroy",i.value.id),{preserveScroll:!0,onSuccess:()=>{i.value=null,b.value=null,s()},onError:()=>{n(new Error("Failed to delete file"))}})})}catch(s){M.error(s),console.log(s)}}},N=z(I),w=p([]);let u="";return K({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":x.props.csrf},onerror:s=>{console.log("on error"),u=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),u.errors&&u.errors.upload_file?u.errors.upload_file.join(" "):u.message)}),B(()=>{Echo.private(`App.Models.User.${y.value.id}`).listen("FileStatusUpdate",s=>{k.reload({only:["uploaded_files"]})})}),O(()=>{Echo.leave(`App.Models.User.${y.value.id}`)}),(s,n)=>(l(),a(D,null,[o(m(A),{title:"File Upload"}),o(V,null,{header:d(()=>[_(" Files ")]),default:d(()=>[e("div",X,[r.trashed_file_count?(l(),a("div",Z,[o(m(R),{href:s.route("files.index",{show_deleted:!r.show_deleted}),type:"button",class:"mb-4 btn text-white bg-violet-500 border-violet-500 hover:bg-violet-600 hover:border-violet-600 focus:bg-violet-600 focus:border-violet-600 focus:ring focus:ring-violet-500/30 active:bg-violet-600 active:border-violet-600"},{default:d(()=>[_(c(r.show_deleted?"Hide":"Show")+" Deleted Files ",1)]),_:1},8,["href"])])):f("",!0),e("div",G,[o(m(N),{name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=t=>w.value=t)},null,8,["modelValue"])]),r.uploaded_files.data.length?(l(),a("div",Q,[e("div",W,[e("div",ee,[e("div",te,[e("table",se,[oe,e("tbody",le,[(l(!0),a(D,null,T(r.uploaded_files.data,t=>(l(),a("tr",{key:t.id},[e("td",ae,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},c(t.original_name),9,re)]),e("td",ie,[e("p",null,c(m($)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",ne,"by "+c(t.user.name),1)]),e("td",de,c(t.size_readable),1),e("td",ce,[e("span",{class:Y(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",m(F)(g[t.id]==="Deleting"?"Deleting":t.status)])},c(g[t.id]==="Deleting"?"Deleting":t.status),3)]),e("td",ue,[t.status=="Pending"||t.status=="Completed"?(l(),a("button",{key:0,onClick:xe=>C(t)},_e,8,me)):f("",!0),t.status=="Deleted"?(l(),a("div",fe," Restore | Permanently Delete ")):f("",!0)])]))),128))])])])])])])):f("",!0),o(q,{dataset:r.uploaded_files,class:"mt-4"},null,8,["dataset"]),o(H,{show:h.value,onClose:v},{default:d(()=>[e("div",he,[ve,e("div",ge,[o(J,{onClick:v},{default:d(()=>[_(" Cancel ")]),_:1}),o(L,{class:"ml-3",onClick:n[1]||(n[1]=t=>S())},{default:d(()=>[_(" Delete File ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Se as default};
