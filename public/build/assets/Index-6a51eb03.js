import{_ as M,t as $,h as E,f as N}from"./AuthenticatedLayout-783a98d5.js";import{K as U,h as B,m as u,C as O,k as P,O as k,D as A,o as n,f as i,a as o,u as m,w as d,F as w,Z as j,d as h,b as e,s as T,g as F,t as c,n as Y}from"./app-aabc17b9.js";import{V as z,p as R,s as I}from"./filepond-plugin-file-validate-type.esm-4eaa35dc.js";import{_ as K}from"./Pagination-a34eb04f.js";import{_ as q,a as J,D as L}from"./DangerButton-e369c2e2.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./feather-27ca1f5c.js";const X={class:"py-6"},Z={class:"py-6"},G={key:0,class:"flex flex-col"},H={class:"overflow-x-auto"},Q={class:"inline-block min-w-full align-middle"},W={class:"overflow-visible"},ee={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},te=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"}," Action ")])],-1),se={class:"divide-y divide-gray-200 dark:divide-gray-600"},oe={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ae=["href"],le={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},re={class:"text-xs"},ne={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ie={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},de={class:"p-3.5"},ce=["onClick"],ue=e("i",{class:"bx bx-trash text-lg hover:text-red-400"},null,-1),me=[ue],pe={class:"p-6"},_e=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),fe={class:"mt-6 flex justify-end"},Fe={__name:"Index",props:{uploaded_files:{type:Object}},setup(p){const x=U(),v=B(()=>x.props.auth.user),{getFileStatusClass:D}=N(),a=u(null),_=u(!1),C=s=>{_.value=!0,a.value=s},f=()=>{_.value=!1},y=u(null),g=O({}),S=async()=>{if(a.value){y.value=a.value.id,g[a.value.id]="Deleting",f();try{await new Promise((s,l)=>{k.delete(route("files.destroy",a.value.id),{preserveScroll:!0,onSuccess:()=>{a.value=null,y.value=null,s()},onError:()=>{l(new Error("Failed to delete file"))}})})}catch(s){$.error(s),console.log(s)}}},V=z(R),b=u([]);let r="";return I({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":x.props.csrf},onerror:s=>{console.log("on error"),r=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),r.errors&&r.errors.upload_file?r.errors.upload_file.join(" "):r.message)}),P(()=>{Echo.private(`App.Models.User.${v.value.id}`).listen("FileStatusUpdate",s=>{k.reload({only:["uploaded_files"]})})}),A(()=>{Echo.leave(`App.Models.User.${v.value.id}`)}),(s,l)=>(n(),i(w,null,[o(m(j),{title:"File Upload"}),o(M,null,{header:d(()=>[h(" Files ")]),default:d(()=>[e("div",X,[e("div",Z,[o(m(V),{name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=t=>b.value=t)},null,8,["modelValue"])]),p.uploaded_files.data.length?(n(),i("div",G,[e("div",H,[e("div",Q,[e("div",W,[e("table",ee,[te,e("tbody",se,[(n(!0),i(w,null,T(p.uploaded_files.data,t=>(n(),i("tr",{key:t.id},[e("td",oe,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},c(t.original_name),9,ae)]),e("td",le,[e("p",null,c(m(E)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",re,"by "+c(t.user.name),1)]),e("td",ne,c(t.size_readable),1),e("td",ie,[e("span",{class:Y(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",m(D)(g[t.id]==="Deleting"?"Deleting":t.status)])},c(g[t.id]==="Deleting"?"Deleting":t.status),3)]),e("td",de,[t.status=="Pending"||t.status=="Completed"?(n(),i("button",{key:0,onClick:ge=>C(t)},me,8,ce)):F("",!0)])]))),128))])])])])])])):F("",!0),o(K,{dataset:p.uploaded_files,class:"mt-4"},null,8,["dataset"]),o(q,{show:_.value,onClose:f},{default:d(()=>[e("div",pe,[_e,e("div",fe,[o(J,{onClick:f},{default:d(()=>[h(" Cancel ")]),_:1}),o(L,{class:"ml-3",onClick:l[1]||(l[1]=t=>S())},{default:d(()=>[h(" Delete File ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Fe as default};
