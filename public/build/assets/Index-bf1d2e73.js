import{_ as P,h as V,f as R}from"./AuthenticatedLayout-c97efddc.js";import{o as a,c as w,w as o,z as j,u as d,I as A,Q as B,h as M,r as v,b5 as U,S as L,j as z,O as F,l as T,d as n,b as i,F as k,Z as Y,f as _,a as e,t as p,e as g,g as I,n as y}from"./app-120fdf01.js";import{V as q,p as J,s as K}from"./filepond.min-70f97573.js";import{_ as Q}from"./Pagination-b12e8272.js";import{_ as X}from"./Modal-4ada2614.js";import{_ as Z}from"./SecondaryButton-c9d6d4c4.js";import{t as G}from"./toast-edd09b35.js";import{_ as E}from"./DangerButton-fd385f60.js";import{_ as H}from"./PrimaryLink-8124164b.js";import"./DropdownLink-e6e87bfa.js";import"./index-6079fcfa.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ToastList-b490e433.js";const W={__name:"SuccessLink",props:{type:{type:String,default:"button"}},setup(l){return(c,x)=>(a(),w(d(A),{type:l.type,class:"btn text-white bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600 focus:bg-green-600 focus:border-green-600 focus:ring focus:ring-green-500/30 active:bg-green-600 active:border-green-600"},{default:o(()=>[j(c.$slots,"default")]),_:3},8,["type"]))}},ee={class:"py-6"},te={key:0,class:"relative flex justify-end mb-4"},se={class:"py-6"},ae={key:1,class:"flex flex-col"},le={class:"overflow-x-auto"},oe={class:"inline-block min-w-full align-middle"},re={class:"overflow-visible"},ne={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-600"},ie=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",{class:"text-gray-800 dark:text-gray-300"},[e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," File Name "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[10rem]"}," Uploaded "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[6rem]"}," File Size "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold min-w-[8rem]"}," Status "),e("th",{scope:"col",class:"p-3.5 text-sm text-start font-semibold"})])],-1),de={class:"divide-y divide-gray-200 dark:divide-gray-600"},ce={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ue=["href"],me={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},pe={class:"text-xs"},fe={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},_e={class:"p-3.5 text-sm text-gray-700 dark:text-gray-400"},ge={class:"relative mr-1.5 flex h-2.5 w-2.5"},he={class:"p-3.5"},ve=e("i",{class:"bx bx-trash text-lg"},null,-1),ye={key:1},xe={class:"p-6"},be=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this document? ",-1),Se={class:"mt-6 flex justify-end"},Be={__name:"Index",props:{uploaded_files:{type:Object},archived:{type:Number},trashed_file_count:{type:Number}},setup(l){const c=B(),x=M(()=>c.props.auth.user),{getFileStatusClass:h}=R(),u=v(null),b=v(!1),$=s=>{b.value=!0,u.value=s},S=()=>{b.value=!1},D=v(null),m=U({}),N=async()=>{if(u.value){D.value=u.value.id,m[u.value.id]="Deleting",S();try{await new Promise((s,r)=>{F.delete(route("files.destroy",u.value.id),{preserveScroll:!0,onSuccess:()=>{m[u.value.id]="",u.value=null,D.value=null,s()},onError:()=>{r(new Error("Failed to delete file"))}})})}catch(s){G.error(s),console.log(s)}}},O=q(J),C=v([]);let f="";return K({credits:[],required:!0,allowMultiple:!0,allowRevert:!1,acceptedFileTypes:["application/pdf"],server:{process:{url:"/files",headers:{Accept:"application/json","X-CSRF-TOKEN":c.props.csrf},onerror:s=>{console.log("on error"),f=JSON.parse(s)}}},labelFileProcessingError:s=>(console.log(s),f.errors&&f.errors.upload_file?f.errors.upload_file.join(" "):f.message)}),L(x,(s,r)=>{r&&Echo.leave(`tenant-global-channel.${c.props.tenant_id}`)},{immediate:!1}),z(()=>{Echo.private(`tenant-global-channel.${c.props.tenant_id}`).listen("FileStatusUpdate",s=>{F.reload({only:["uploaded_files"]})})}),T(()=>{x.value&&Echo.leave(`tenant-global-channel.${c.props.tenant_id}`)}),(s,r)=>(a(),n(k,null,[i(d(Y),{title:"File Upload"}),i(P,null,{header:o(()=>[_(" Files ")]),default:o(()=>[e("div",ee,[l.trashed_file_count?(a(),n("div",te,[i(H,{href:s.route("files.index",{archived:!l.archived})},{default:o(()=>[_(p(l.archived?"Current":"Archived")+" Files ",1)]),_:1},8,["href"])])):g("",!0),e("div",se,[l.archived?g("",!0):(a(),w(d(O),{key:0,name:"upload_file",ref:"pond","class-name":"my-file-upload","label-idle":"Drag & Drop your PDF files here or <span class='filepond--label-action'>Browse</span>",modelValue:C.value,"onUpdate:modelValue":r[0]||(r[0]=t=>C.value=t)},null,8,["modelValue"]))]),l.uploaded_files.data.length?(a(),n("div",ae,[e("div",le,[e("div",oe,[e("div",re,[e("table",ne,[ie,e("tbody",de,[(a(!0),n(k,null,I(l.uploaded_files.data,t=>(a(),n("tr",{key:t.id},[e("td",ce,[e("a",{href:t.download_link,target:"_blank",rel:"noopener noreferrer",class:"font-medium"},p(t.original_name),9,ue)]),e("td",me,[e("p",null,p(d(V)(t.created_at).format("MMM DD, YYYY h:mma")),1),e("span",pe,"by "+p(t.user.name),1)]),e("td",fe,p(t.size_readable),1),e("td",_e,[e("span",{class:y(["inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",d(h)(m[t.id]==="Deleting"?"Deleting":t.status)])},[e("span",ge,[t.status!="Completed"?(a(),n(k,{key:0},[e("span",{class:y(["absolute inline-flex h-full w-full animate-ping rounded-full",d(h)(m[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2),e("span",{class:y(["relative inline-flex h-2.5 w-2.5 rounded-full",d(h)(m[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2)],64)):(a(),n("span",{key:1,class:y(["relative inline-flex h-2.5 w-2.5 rounded-full",d(h)(m[t.id]==="Deleting"?"Deleting":t.status,"PROCESS_CLASSES")])},null,2))]),e("span",null,p(m[t.id]==="Deleting"?"Deleting":t.status),1)],2)]),e("td",he,[["Pending","Completed","Failed"].includes(t.status)?(a(),w(E,{key:0,onClick:ke=>$(t)},{default:o(()=>[ve]),_:2},1032,["onClick"])):g("",!0),t.status=="Deleted"?(a(),n("div",ye,[i(W,{href:s.route("files.restore",t),method:"post",as:"button"},{default:o(()=>[_(" Restore ")]),_:2},1032,["href"])])):g("",!0)])]))),128))])])])])])])):g("",!0),i(Q,{dataset:l.uploaded_files,class:"mt-4"},null,8,["dataset"]),i(X,{show:b.value,onClose:S},{default:o(()=>[e("div",xe,[be,e("div",Se,[i(Z,{onClick:S},{default:o(()=>[_(" Cancel ")]),_:1}),i(E,{class:"ml-3",onClick:r[1]||(r[1]=t=>N())},{default:o(()=>[_(" Delete ")]),_:1})])])]),_:1},8,["show"])])]),_:1})],64))}};export{Be as default};
